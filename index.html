<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Albums Musicaux</title>
<style>
:root {
    --bg-main: #e9e0cf;        /* beige doux */
    --bg-card: #f5efe4;        /* beige clair */
    --bg-header: #d6c8b0;      /* beige soutenu */
    --bg-row-alt: #efe7d8;     /* seconde teinte pour zebra */
    --text-main: #2b2b2b;      /* gris très foncé */
    --accent-border: #b8a98d;  /* lignes / contours */
    --button-bg: #d6c8b0;
    --button-border: #948568;
    --button-hover: #c8b89c;
    --radius: 10px;
    --shadow: 0 4px 10px rgba(0,0,0,0.15);
    --font-main: -apple-system, BlinkMacSystemFont,"SF Pro Text",Roboto,Helvetica,Arial,sans-serif;
    --badge-bg: #3a7f3a;       /* vert foncé discret */
    --badge-text: #ffffff;
}

body{
    background-color:var(--bg-main);
    color:var(--text-main);
    font-family:var(--font-main);
    margin:0;
    padding:0;
    min-height:100vh;
    display:flex;
    flex-direction:column;
}

/* HEADER TOP */
header{
    background:var(--bg-header);
    color:var(--text-main);
    padding:12px 16px;
    box-shadow:var(--shadow);
    display:flex;
    flex-wrap:wrap;
    align-items:flex-start;
    justify-content:space-between;
    gap:8px;
}
header .title-block{
    font-size:1.1rem;
    font-weight:600;
    line-height:1.2;
}
header .version-block{
    font-size:.8rem;
    opacity:.8;
}

/* INFO BAR SOUS LE HEADER */
.top-info-bar{
    display:flex;
    flex-wrap:wrap;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    background:var(--bg-card);
    border-bottom:1px solid var(--accent-border);
    padding:12px 16px;
    box-shadow:var(--shadow);
    z-index:5;
}

.counter-badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    background:var(--badge-bg);
    color:var(--badge-text);
    border-radius:var(--radius);
    padding:8px 12px;
    font-size:.85rem;
    line-height:1.2;
    font-weight:500;
    min-height:32px;
}

.counter-badge span.count{
    font-weight:600;
    font-size:1rem;
}

.export-wrapper{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    align-items:center;
}

button{
    background:var(--button-bg);
    border:1px solid var(--button-border);
    border-radius:var(--radius);
    padding:8px 12px;
    font-size:.9rem;
    line-height:1.2;
    color:var(--text-main);
    cursor:pointer;
}
button:hover{
    background:var(--button-hover);
}

main{
    flex:1;
    padding:16px;
}

/* TABLE CONTAINER */
.table-wrapper{
    background:var(--bg-card);
    border:1px solid var(--accent-border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    overflow-x:auto;
}

/* TABLE STYLE */
table{
    width:100%;
    border-collapse:collapse;
    min-width:600px;
    font-size:.9rem;
}
thead th{
    background:var(--bg-header);
    color:var(--text-main);
    padding:10px;
    text-align:left;
    position:sticky;
    top:0;
    cursor:pointer;
    user-select:none;
    border-bottom:1px solid var(--accent-border);
    white-space:nowrap;
    z-index:2;
}
thead th.sortable::after{
    content:" ⇅";
    font-size:.8rem;
    opacity:.6;
}

/* zebra rows beige */
tbody tr:nth-child(odd){
    background:rgba(255,255,255,0.15);
}
tbody tr:nth-child(even){
    background:var(--bg-row-alt);
}

tbody td{
    padding:10px;
    vertical-align:top;
    border-bottom:1px solid var(--accent-border);
    color:var(--text-main);
}

.tag-inconnu{
    display:inline-block;
    background:#fffdf8;
    border:1px solid var(--accent-border);
    border-radius:var(--radius);
    font-size:.7rem;
    line-height:1.2;
    padding:2px 6px;
    opacity:.8;
}

/* FOOTER */
footer{
    text-align:center;
    font-size:.8rem;
    color:var(--text-main);
    opacity:.7;
    padding:16px 12px 32px;
}

/* POPUP caché dans cette version mais je le laisse au cas où tu voudras le réactiver plus tard */
dialog{
    border:1px solid var(--accent-border);
    border-radius:var(--radius);
    padding:16px;
    background:var(--bg-card);
    box-shadow:var(--shadow);
    width:min(90vw,400px);
}
dialog::backdrop{
    background:rgba(0,0,0,.4);
}
.popup-header{
    font-weight:600;
    font-size:1rem;
    margin-bottom:8px;
    color:var(--text-main);
}
.popup-section{
    display:flex;
    flex-direction:column;
    gap:6px;
    margin-bottom:12px;
}
.popup-section label{
    font-size:.8rem;
    opacity:.8;
}
.popup-section input,
.popup-section textarea{
    width:100%;
    border-radius:var(--radius);
    border:1px solid var(--accent-border);
    background:#fffdf8;
    font-family:var(--font-main);
    font-size:.9rem;
    padding:8px;
    box-sizing:border-box;
}
.popup-actions{
    display:flex;
    justify-content:flex-end;
    gap:8px;
    flex-wrap:wrap;
}
.muted{
    font-size:.8rem;
    opacity:.7;
}
</style>
</head>
<body>

<header>
    <div class="title-block">
        <div>Catalogue Albums Musicaux</div>
        <div class="version-block">v1.1 — © Pierre Charlier 2025</div>
    </div>
</header>

<!-- barre info -->
<div class="top-info-bar">
    <div class="counter-badge">
        <span>Total albums :</span>
        <span class="count" id="albumCount">0</span>
    </div>

    <div class="export-wrapper">
        <button id="exportCsvBtn">Exporter CSV</button>
    </div>
</div>

<main>
    <div class="table-wrapper">
        <table id="albumTable">
            <thead>
                <tr>
                    <th class="sortable" data-col="title">Album</th>
                    <th class="sortable" data-col="artist">Artiste</th>
                    <th>Autres infos</th>
                    <th class="sortable" data-col="year">Année</th>
                </tr>
            </thead>
            <tbody id="albumTbody">
                <!-- Lignes générées par JS -->
            </tbody>
        </table>
    </div>
</main>

<footer>
    Données stockées localement sur cet appareil.
</footer>

<!-- POPUP conservé (non utilisé v1.1) -->
<dialog id="trackDialog">
    <div class="popup-header">Détails de l'album</div>

    <div class="popup-section">
        <label for="dialogTitle">Titre de l'album</label>
        <input type="text" id="dialogTitle">
    </div>

    <div class="popup-section">
        <label for="dialogArtist">Artiste / Groupe</label>
        <input type="text" id="dialogArtist">
    </div>

    <div class="popup-section">
        <label for="dialogInfo">Autres infos (Live, Best of, etc.)</label>
        <input type="text" id="dialogInfo">
    </div>

    <div class="popup-section">
        <label for="dialogYear">Année</label>
        <input type="text" id="dialogYear" inputmode="numeric">
    </div>

    <div class="popup-section">
        <label for="dialogTracks">Titres des plages (une ligne par piste)</label>
        <textarea id="dialogTracks" rows="8" style="resize:none;"></textarea>
        <div class="muted">Exemple:<br>01. Intro<br>02. Chanson suivante<br>...</div>
    </div>

    <div class="popup-actions">
        <button id="cancelDialogBtn">Annuler</button>
        <button id="saveDialogBtn">Enregistrer</button>
    </div>
</dialog>

<script>
/* ------------------------------
   Données initiales (A → W)
---------------------------------*/
let albums = [
    {title:"La thune - Single",artist:"Angèle",info:"",year:""},
    {title:"Ma vie en musique",artist:"Annie Cordy",info:"Best of 50 titres",year:""},

    {title:"Amor Amor",artist:"Arielle Dombasle",info:"",year:""},
    {title:"C'est si bon",artist:"Arielle Dombasle",info:"",year:""},
    {title:"Diva Latina",artist:"Arielle Dombasle",info:"",year:""},
    {title:"Extase",artist:"Arielle Dombasle",info:"",year:""},
    {title:"Glamour à mort",artist:"Arielle Dombasle",info:"",year:""},
    {title:"Liberta",artist:"Arielle Dombasle",info:"",year:""},

    {title:"Bach: Brandenburg Concertos",artist:"Bach / Reinhard Goebel / Musica Antiqua Köln",info:"Concertos Brandebourgeois",year:""},
    {title:"Hymnes Nationaux",artist:"Batterie Fanfare de la Garde Républicaine",info:"",year:""},

    {title:"Help!",artist:"The Beatles",info:"",year:""},
    {title:"Please Please Me",artist:"The Beatles",info:"",year:""},
    {title:"Revolver",artist:"The Beatles",info:"",year:""},
    {title:"Sgt. Pepper's Lonely Hearts Club Band",artist:"The Beatles",info:"",year:""},
    {title:"Yellow Submarine Songtrack",artist:"The Beatles",info:"",year:""},

    {title:"Beethoven: Violin Sonatas (Oistrakh / Oborin)",artist:"Beethoven",info:"Sonates violon/piano",year:""},
    {title:"Symphony No. 3 \"Eroica\"",artist:"Beethoven / Eugen Jochum",info:"Concert Classics",year:""},

    {title:"La p'tite monnaie",artist:"Bénabar et associés",info:"",year:""},

    {title:"Carmina Burana",artist:"Carl Orff / New Jersey Symphony Orchestra",info:"",year:""},
    {title:"Encore un soir (Deluxe)",artist:"Céline Dion",info:"Deluxe",year:""},
    {title:"Charles Trenet : 100 chansons",artist:"Charles Trenet",info:"100 chansons",year:""},

    {title:"Big Band",artist:"Eddy Mitchell",info:"★",year:""},
    {title:"Come Back",artist:"Eddy Mitchell",info:"★",year:""},
    {title:"Frenchy",artist:"Eddy Mitchell",info:"★",year:""},
    {title:"Grand écran",artist:"Eddy Mitchell",info:"★",year:""},
    {title:"Héros",artist:"Eddy Mitchell",info:"★",year:""},
    {title:"Jambalaya",artist:"Eddy Mitchell",info:"★",year:""},
    {title:"La même tribu (Vol. 1)",artist:"Eddy Mitchell",info:"★",year:""},
    {title:"La même tribu (Vol. 2)",artist:"Eddy Mitchell",info:"★",year:""},
    {title:"Les Nocturnes",artist:"Eddy Mitchell",info:"★",year:""},
    {title:"Les 100 Plus Belles Chansons",artist:"Eddy Mitchell",info:"★ Best of",year:""},

    {title:"Bruitage",artist:"Effets sonores",info:"Bruits / FX",year:""},
    {title:"The Complete '70s Albums Collection",artist:"Elvis Presley",info:"Compil 70s",year:""},
    {title:"The Essential Elvis Presley",artist:"Elvis Presley",info:"Best of / Essential",year:""},

    {title:"L'Essentiel",artist:"Françoise Hardy",info:"Compilation",year:""},
    {title:"Parenthèses...",artist:"Françoise Hardy",info:"",year:""},

    {title:"The Best of Georges Brassens",artist:"Georges Brassens",info:"Best of",year:""},
    {title:"Les dernières chansons...",artist:"Georges Brassens & Jean Bertola",info:"Dernières chansons",year:""},

    {title:"Haydn: Symphonies #94 'Surprise' / #101 'The Clock'",artist:"Haydn / London Philharmonic / Eugen Jochum",info:"",year:""},
    {title:"Haydn: The 'London' Symphonies",artist:"Haydn / Sir Georg Solti",info:"",year:""},
    {title:"Symphonies 99-104 (Part 1)",artist:"Haydn / Royal Philharmonic / Sir Thomas Beecham",info:"",year:""},
    {title:"Symphonies 99-104 (Part 2)",artist:"Haydn / Royal Philharmonic / Sir Thomas Beecham",info:"",year:""},

    {title:"Chambre Avec Vue",artist:"Henri Salvador",info:"",year:""},
    {title:"Marches Militaires Internationales",artist:"International",info:"Marches militaires",year:""},

    {title:"Les marquises",artist:"Jacques Brel",info:"",year:""},
    {title:"Suivre l'étoile",artist:"Jacques Brel",info:"Intégrale ? ★",year:""},
    {title:"50 plus belles chansons",artist:"Jacques Brel",info:"Compil / 50",year:""},

    {title:"Zanaka",artist:"Jain",info:"",year:""},
    {title:"Birkin / Gainsbourg : le symphonique",artist:"Jane Birkin",info:"Symphonique ★",year:""},
    {title:"Imagine",artist:"John Lennon",info:"★",year:""},

    {title:"Ça ne finira jamais",artist:"Johnny Hallyday",info:"★",year:""},
    {title:"Le Coeur D'Un Homme",artist:"Johnny Hallyday",info:"★",year:""},
    {title:"De l'Amour",artist:"Johnny Hallyday",info:"★",year:""},
    {title:"Jamais seul",artist:"Johnny Hallyday",info:"★",year:""},
    {title:"L'attente",artist:"Johnny Hallyday",info:"★",year:""},
    {title:"Ma vérité",artist:"Johnny Hallyday",info:"★",year:""},
    {title:"Mon pays c'est l'amour",artist:"Johnny Hallyday",info:"★",year:""},
    {title:"Rester vivant",artist:"Johnny Hallyday",info:"★",year:""},
    {title:"Les 100 Plus Belles Chansons",artist:"Johnny Hallyday",info:"Best of ★",year:""},

    {title:"Prénoms filles et garçons... (Album 9)",artist:"Joyeux Anniversaire",info:"Prénoms A à S",year:""},
    {title:"Au Bon Vieux Temps des Orgues de Foire",artist:"Jules Et Son Limonaire",info:"Orgues de foire",year:""},

    {title:"À nos amours (Édition Deluxe)",artist:"Julien Clerc",info:"Deluxe",year:""},
    {title:"Fans, je vous aime",artist:"Julien Clerc",info:"",year:""},
    {title:"Fou, peut-être",artist:"Julien Clerc",info:"",year:""},
    {title:"Partout la musique vient",artist:"Julien Clerc",info:"",year:""},

    {title:"Can't Forget: A Souvenir of the Grand Tour",artist:"Leonard Cohen",info:"Live ★",year:""},
    {title:"Clips vidéo",artist:"Leonard Cohen",info:"Vidéos ★",year:""},
    {title:"Live In Dublin",artist:"Leonard Cohen",info:"Live ★",year:""},
    {title:"Live In London",artist:"Leonard Cohen",info:"Live ★",year:""},
    {title:"Les Nocturnes",artist:"Leonard Cohen",info:"★",year:""},
    {title:"Popular Problems",artist:"Leonard Cohen",info:"★",year:""},
    {title:"Songs From the Road",artist:"Leonard Cohen",info:"Live ★",year:""},
    {title:"The Complete Studio Albums Collection",artist:"Leonard Cohen",info:"Coffret ★",year:""},
    {title:"You Want It Darker",artist:"Leonard Cohen",info:"★",year:""},

    {title:"Premier album (Remasterisé)",artist:"Lio",info:"Remaster",year:""},

    {title:"Madame X",artist:"Madonna",info:"",year:""},
    {title:"Ray of Light",artist:"Madonna",info:"",year:""},
    {title:"Rebel Heart (Deluxe)",artist:"Madonna",info:"Deluxe",year:""},

    {title:"Christmas",artist:"Michael Bublé",info:"Noël / Christmas",year:""},

    {title:"Être une femme (2010)",artist:"Michel Sardou",info:"",year:""},
    {title:"Le choix du fou",artist:"Michel Sardou",info:"",year:""},
    {title:"Les grands moments - Best of",artist:"Michel Sardou",info:"Best of",year:""},

    {title:"La grande roue",artist:"Salvatore Adamo",info:"★",year:""},
    {title:"Le bal des gens bien",artist:"Salvatore Adamo",info:"★",year:""},
    {title:"Par les temps qui courent",artist:"Salvatore Adamo",info:"★",year:""},
    {title:"La Part De l'Ange",artist:"Salvatore Adamo",info:"★",year:""},
    {title:"Regards",artist:"Salvatore Adamo",info:"★",year:""},
    {title:"Si vous saviez...",artist:"Salvatore Adamo",info:"★",year:""},
    {title:"Triple Best of Adamo",artist:"Salvatore Adamo",info:"Triple Best Of ★",year:""},
    {title:"Zanzibar",artist:"Salvatore Adamo",info:"★",year:""},
    {title:"De toi à moi",artist:"Salvatore Adamo",info:"★",year:""},
    {title:"In French Please!",artist:"Salvatore Adamo",info:"",year:""},
    {title:"L'amour n'a jamais tort",artist:"Salvatore Adamo",info:"★",year:""},
    {title:"Adamo chante Becaud",artist:"Salvatore Adamo",info:"Hommage à Bécaud ★",year:""},

    {title:"Chansons de la Révolution",artist:"Les Sans Culottes",info:"",year:""},
    {title:"Rétrospective - Triple Best Of",artist:"Sheila",info:"Triple Best Of",year:""},

    {title:"Bach: Toccata & Fugue BWV 565 / Préludes & Fugues",artist:"Johann Sebastian Bach / Simon Preston",info:"Orgue",year:""},
    {title:"Remixes - Single",artist:"Stromae",info:"Single / Remixes",year:""},

    {title:"Avec toi...",artist:"Sylvie Vartan",info:"",year:""},
    {title:"Baby c'est vou",artist:"Sylvie Vartan",info:"",year:""},
    {title:"Les 50 Plus belles chansons",artist:"Sylvie Vartan",info:"Compil / 50",year:""},
    {title:"Nouvelle vague",artist:"Sylvie Vartan",info:"★",year:""},
    {title:"Soleil bleu",artist:"Sylvie Vartan",info:"★",year:""},
    {title:"Sylvie in Nashville",artist:"Sylvie Vartan",info:"★ Nashville",year:""},
    {title:"Toutes peines confondues",artist:"Sylvie Vartan",info:"★",year:""},

    {title:"Musical Moments To Remember, Vol. 1",artist:"The Andrews Sisters",info:"",year:""},
    {title:"50+ Greatest Hits",artist:"The Andrews Sisters",info:"Greatest Hits ★",year:""},

    {title:"Vivaldi: The Four Seasons",artist:"Vivaldi",info:"",year:""},

    {title:"Savages",artist:"The Webb Sisters",info:"★",year:""},
    {title:"When Will You Come Home?",artist:"The Webb Sisters",info:"★",year:""},

    {title:"Best of Les Parisiennes",artist:"Les Parisiennes",info:"Best of",year:""},
    {title:"Les Parisiennes",artist:"Les Parisiennes",info:"",year:""},

    {title:"Patricia Kaas",artist:"Patricia Kaas",info:"★",year:""},
    {title:"19 par Patricia Kaas (19 titres essentiels)",artist:"Patricia Kaas",info:"Compilation",year:""},

    {title:"Drôle de Poésie !",artist:"Pierre Perret",info:"",year:""},
    {title:"Du Rire Aux Larmes",artist:"Pierre Perret",info:"★",year:""},
    {title:"Humour liberté",artist:"Pierre Perret",info:"",year:""},
    {title:"La femme grillagée",artist:"Pierre Perret",info:"★",year:""},
    {title:"La tribu de Pierre Perret...",artist:"Pierre Perret (& invités)",info:"Hommage / collectif",year:""},
    {title:"Les dieux paillards",artist:"Pierre Perret",info:"★ (E)",year:""},
    {title:"Mes chansons engagées",artist:"Pierre Perret",info:"★",year:""},

    {title:"Grandes chansons",artist:"Ray Ventura",info:"",year:""},
    {title:"Rita Mitsouko",artist:"Les Rita Mitsouko",info:"",year:""},

    {title:"Belgian Military Marches Vol. 1 (Cavalry)",artist:"Royal Symphonic Band of the Belgian Guides",info:"Marches militaires",year:""},
    {title:"Belgian Military Marches Vol. 2 (Infantry)",artist:"Royal Symphonic Band of the Belgian Guides",info:"Marches militaires",year:""},
    {title:"Belgian Military Marches Vol. 3 (Artillery...)",artist:"Royal Symphonic Band of the Belgian Guides",info:"Marches militaires",year:""},
    {title:"French Military Marches",artist:"Royal Symphonic Band of the Belgian Guides",info:"Marches militaires",year:""},

    {title:"Mozart: Piano Concertos (Elvira Madigan…)",artist:"Mozart",info:"Concertos piano",year:""},
    {title:"Orchestre National... (Mozart)",artist:"Mozart / Orchestre National ?",info:"Titre incomplet",year:""},
    {title:"A Very Special Christmas (65 Festive Tracks)",artist:"Multi-interprètes",info:"Compilation Noël",year:""},
    {title:"In the Summertime",artist:"Mungo Jerry",info:"",year:""},
    {title:"Anthologie de la musique militaire française",artist:"Musique des équipages de la Flotte / etc.",info:"Des origines à 1870",year:""},
    {title:"Marche du 13ème de Ligne",artist:"Musique des Guides",info:"Pierre Charlier crédit pochette",year:""},
    {title:"Musiques du Premier Empire",artist:"Musiques de la Garde Impériale / etc.",info:"Napoléon ★",year:""},
    {title:"Dance Remixes",artist:"Mylène Farmer",info:"Remixes",year:""},
    {title:"Bretonne",artist:"Nolwenn Leroy",info:"★",year:""},
    {title:"Gemme",artist:"Nolwenn Leroy",info:"★",year:""},
    {title:"Ô filles de l'eau",artist:"Nolwenn Leroy",info:"★",year:""},
    {title:"The 50 Greatest Pieces of Classical Music",artist:"London Philharmonic Orchestra",info:"Compilation classique",year:""},
    {title:"La belle époque des orgues Gavioli",artist:"Orgue Gavioli",info:"Orgues mécaniques",year:""},
    {title:"Paolo Conte (Tournée² ?)",artist:"Paolo Conte",info:"Live ?",year:""},
    {title:"Wonderful",artist:"Paolo Conte",info:"",year:""}
];

/* ----- stockage local ----- */
const STORAGE_KEY="albumsCatalogueV1_1";

function autoSave(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(albums));
}

/* ----- rendu du tableau ----- */
const tbody=document.getElementById("albumTbody");
const countSpan=document.getElementById("albumCount");

let currentSortCol=null;
let currentSortDir="asc";

function renderTable(sortCol=null, sortDir="asc"){
    let rows=[...albums];

    // tri si demandé
    if(sortCol){
        rows.sort((a,b)=>{
            const va=(a[sortCol]||"").toString().toLowerCase();
            const vb=(b[sortCol]||"").toString().toLowerCase();
            if(va<vb) return sortDir==="asc"?-1:1;
            if(va>vb) return sortDir==="asc"?1:-1;
            return 0;
        });
    }

    tbody.innerHTML="";
    rows.forEach((album)=>{
        const tr=document.createElement("tr");

        const tdTitle=document.createElement("td");
        tdTitle.textContent=album.title||"";
        if(!album.title && !album.artist){
            const tag=document.createElement("span");
            tag.className="tag-inconnu";
            tag.textContent="inconnu";
            tdTitle.appendChild(document.createElement("br"));
            tdTitle.appendChild(tag);
        }

        const tdArtist=document.createElement("td");
        tdArtist.textContent=album.artist||"";

        const tdInfo=document.createElement("td");
        tdInfo.textContent=album.info||"";

        const tdYear=document.createElement("td");
        tdYear.textContent=album.year||"";

        tr.appendChild(tdTitle);
        tr.appendChild(tdArtist);
        tr.appendChild(tdInfo);
        tr.appendChild(tdYear);

        tbody.appendChild(tr);
    });

    // compteur vert
    countSpan.textContent = rows.length.toString();

    // sauvegarde auto à chaque rendu
    autoSave();
}

/* ----- tri par clic colonne ----- */
document.querySelectorAll("th.sortable").forEach(th=>{
    th.addEventListener("click",()=>{
        const col=th.dataset.col;
        if(currentSortCol===col){
            currentSortDir=currentSortDir==="asc"?"desc":"asc";
        }else{
            currentSortCol=col;
            currentSortDir="asc";
        }
        renderTable(currentSortCol,currentSortDir);
    });
});

/* ----- export CSV ----- */
function exportToCSV(){
    // en-têtes CSV
    const headers=["Album","Artiste","Autres infos","Année"];
    const rows=albums.map(a=>[
        a.title||"",
        a.artist||"",
        a.info||"",
        a.year||""
    ]);

    // construction du texte CSV (séparateur point-virgule ; pour compat Excel fr)
    let csvContent = headers.join(";") + "\n";
    rows.forEach(r=>{
        // échapper les ";", les retours ligne, etc.
        const safe = r.map(cell=>{
            let c = cell.replace(/"/g,'""'); // escape "
            if(c.search(/[;\n"]/)!==-1){
                c = `"${c}"`;
            }
            return c;
        });
        csvContent += safe.join(";") + "\n";
    });

    // création du blob et du lien de téléchargement
    const blob = new Blob([csvContent], {type:"text/csv;charset=utf-8;"});
    const url = URL.createObjectURL(blob);

    const a=document.createElement("a");
    a.href=url;
    a.download="albums.csv"; // iOS demandera où enregistrer / ouvrir
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    // libère l'URL
    URL.revokeObjectURL(url);
}

document.getElementById("exportCsvBtn").addEventListener("click", exportToCSV);

/* ----- rendu initial ----- */
renderTable();
</script>

</body>
</html>